{% extends "base.html" %}
{% block title %}Tags{% endblock %}

{% block content %}

  <h1>Tags</h1>
  <div id="tags">
  {% if tags %}
    <ul>
      {% for tag in tags %}
        <li>
          {{tag.name}}
          <a href="{{ url_for('edit_tag', tag_id=tag.id) }}" class="text-decoration-none">
            <i class="fa-regular fa-pen-to-square" data-tag-id="{{tag.id}}" data-tag-name="{{tag.name}}" ></i>
          </a>
          <i class="fa-regular fa-trash-can delete-button" data-tag-id="{{tag.id}}" data-tag-name="{{tag.name}}"></i>
          <!-- <a href="{{ url_for('delete_tag', tag_id=tag.id) }}">Delete</a> -->
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <span>No tags found.</span>
  {%endif%}
  </div>

  <h1>New Tag</h1>
  
    <form method="POST" action="{{ url_for('show_tags') }}">
        <fieldset class="form-field">
            {{ form.csrf_token }}
            {{ form.name.label }}
            {{ form.name(size=20) }}
            {% if form.name.errors %}
            <ul class="errors">
                {% for error in form.name.errors %}
                    <li>{{ error }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </fieldset>

        {{ form.submit }}
    </form>



  <div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Whoa whoa whoa...</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete this tag?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <a class="btn btn-danger" id="deleteButton">Delete</a>
        </div>
      </div>
    </div>
  </div>
  

{% endblock %}

{% block scripts %}
{{ super() }}
<script>
  $(document).ready(function() {
    // Click event handler for the delete icons
    $('.delete-button').on('click', function() {
      var tagId = $(this).data('tag-id');
      var tagName = $(this).data('tag-name');

      // Update modal content based on the selected tag
      $('#confirmationModal .modal-body').text('Are you sure you want to delete the tag "' + tagName + '"?');

      // Update modal delete button link
      $('#deleteButton').off('click').on('click', function () {
        window.location.href = '/tag/delete/' + tagId;
        $('#confirmationModal').modal('hide');
      });
      
      // Open the modal
      $('#confirmationModal').modal('show');
      
    });
  });
</script>
{% endblock %}